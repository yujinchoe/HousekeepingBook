<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.test.housebook.dao.MoneybookMapper">

<!-- id별 가계부목록 & 수정때 쓸 한객체 가져오기 -->
<select id="boardList" parameterType="moneybook" resultType="moneybook">
	select
		m.moneybook_no
		,m.acc_id
		,m.moneybook_memo
		,m.moneybook_type
		,m.moneybook_amount
		,to_char(m.moneybook_indate, 'yyyy-MM-dd') as moneybook_indate
	from
		moneybook_tb m
	where
		m.acc_id = #{acc_id}
	<if test="moneybook_no > 0">
 	and
  		m.moneybook_no = #{moneybook_no}
  	</if>
	order by
        m.moneybook_indate desc
</select>

<!-- 가계부작성 -->
<insert id="write" parameterType="moneybook">
	insert into moneybook_tb(
		moneybook_no
		,acc_id
		,moneybook_memo
		,moneybook_type
		,moneybook_amount
	)values(
		moneybook_tb_seq.nextval
		,#{acc_id}
		,#{moneybook_memo}
		,#{moneybook_type}
		,#{moneybook_amount}
	)
</insert>

<!-- 가계부 수정 -->
<update id="update" parameterType="moneybook">
	update
		moneybook_tb
	set
		moneybook_memo = #{moneybook_memo}
		,moneybook_type = #{moneybook_type}
		,moneybook_amount = #{moneybook_amount}
	where
		acc_id = #{acc_id}
	and
		moneybook_no = #{moneybook_no}
</update>

<!-- 가계부 삭제 -->
<delete id="delete" parameterType="moneybook">
	delete from
		moneybook_tb
	where
		acc_id = #{acc_id}
	and
		moneybook_no = #{moneybook_no}
</delete>
	
<!-- 가계부 검색 -->
<select id="search" parameterType="HashMap" resultType="moneybook">
	select
		m.moneybook_no
		,m.acc_id
		,m.moneybook_memo
		,m.moneybook_type
		,m.moneybook_amount
		,to_char(m.moneybook_indate, 'yyyy-MM-dd') as moneybook_indate
	from
		moneybook_tb m
	where
		m.acc_id = #{acc_id}
		<if test="condition == '전체'">
	and	trim(upper(m.moneybook_memo)) like '%'|| trim(upper(#{searchWord})) || '%' and (m.moneybook_type = '수입' or m.moneybook_type = '지출')
		</if>
		<if test="condition == '수입'">
	and	trim(upper(m.moneybook_memo)) like '%'|| trim(upper(#{searchWord})) || '%' and m.moneybook_type = '수입'
		</if>
		<if test="condition == '지출'">
	and	trim(upper(m.moneybook_memo)) like '%'|| trim(upper(#{searchWord})) || '%' and m.moneybook_type = '지출'
		</if>
	order by
		m.moneybook_indate desc
</select>

<!-- 총수입 -->
<select id="totalIncome" parameterType="String" resultType="int">
select
    sum(moneybook_amount) as moneybook_amount
from
    moneybook_tb
where
    acc_id = #{acc_id}
and
    moneybook_type = '수입'
</select>

<!-- 총지출 -->
<select id="totalExpense" parameterType="String" resultType="int">
select
    sum(moneybook_amount) as moneybook_amount
from
    moneybook_tb
where
    acc_id = #{acc_id}
and
    moneybook_type = '지출'
</select>

<!-- 최대값 -->
<select id="max" parameterType="String" resultType="int">
select
    max(moneybook_amount) as moneybook_amount
from
    moneybook_tb
where
	acc_id = #{acc_id}
</select>

<!-- 최소값 -->
<select id="min" parameterType="String" resultType="int">
select
    min(moneybook_amount) as moneybook_amount
from
    moneybook_tb
where
	acc_id = #{acc_id}
</select>

</mapper>
